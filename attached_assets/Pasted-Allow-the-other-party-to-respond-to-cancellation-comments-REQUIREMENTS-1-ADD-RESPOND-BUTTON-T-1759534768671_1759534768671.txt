Allow the other party to respond to cancellation comments:

REQUIREMENTS:

1. ADD "RESPOND" BUTTON TO CANCELLATION COMMENTS

In transaction history, when viewing a cancellation where YOU are the other party:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ CANCELLED BY BUYER - September 28, 2024 â”‚
â”‚                                             â”‚
â”‚ ğŸ’» MacBook Pro 16" - $2,200                â”‚
â”‚ Buyer: John Davis â­ 3.6/5.0               â”‚
â”‚ Role: Seller (you)                          â”‚
â”‚ Status: Cancelled 2 hours before meetup     â”‚
â”‚                                             â”‚
â”‚ ğŸ’¬ John's Cancellation Comment:             â”‚
â”‚ Reason: Personal emergency                  â”‚
â”‚ "I'm really sorry for the late             â”‚
â”‚  cancellation. My wife surprised me with   â”‚
â”‚  the same laptop as an early birthday      â”‚
â”‚  gift. I tried to cancel earlier but just  â”‚
â”‚  found out an hour ago. Again, my          â”‚
â”‚  apologies for any inconvenience."          â”‚
â”‚ Posted: Sep 28, 2024 at 2:15 PM             â”‚
â”‚                                             â”‚
â”‚ [Respond to Comment]  â† ADD THIS BUTTON     â”‚
â”‚ (Only visible if you haven't responded yet) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. RESPONSE MODAL

When "Respond to Comment" clicked, show modal:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Respond to Cancellation Comment             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                             â”‚
â”‚ Transaction: MacBook Pro 16" - $2,200       â”‚
â”‚                                             â”‚
â”‚ John's comment:                             â”‚
â”‚ "I'm really sorry for the late             â”‚
â”‚  cancellation. My wife just surprised me   â”‚
â”‚  with the same laptop as an early          â”‚
â”‚  birthday gift..."                          â”‚
â”‚                                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                             â”‚
â”‚ Your response:                              â”‚
â”‚                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ Thanks for explaining! I completely   â”‚   â”‚
â”‚ â”‚ understand - family comes first.      â”‚   â”‚
â”‚ â”‚ Congratulations on the gift!          â”‚   â”‚
â”‚ â”‚                                       â”‚   â”‚
â”‚ â”‚                                       â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ 98 / 500 characters                         â”‚
â”‚                                             â”‚
â”‚ â˜‘ï¸ Make this response public                â”‚
â”‚    (Recommended - shows you're professional)â”‚
â”‚                                             â”‚
â”‚ Note: Your response will be visible on both â”‚
â”‚ your profile and John's profile. Being      â”‚
â”‚ understanding builds your reputation.       â”‚
â”‚                                             â”‚
â”‚ Tips for good responses:                    â”‚
â”‚ â€¢ Be professional and courteous             â”‚
â”‚ â€¢ Acknowledge their explanation             â”‚
â”‚ â€¢ Keep it brief                             â”‚
â”‚ â€¢ No personal attacks                       â”‚
â”‚                                             â”‚
â”‚    [Post Response] [Cancel]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. API ENDPOINT

POST /api/cancellations/:commentId/response

Request body:
{
  responseText: "Thanks for explaining! I understand...",
  isPublic: true
}

Backend logic:
1. Verify user is the OTHER party in the transaction
   - Get cancellation comment
   - Get transaction 
   - If comment.cancelled_by = buyer, verify current user = seller
   - If comment.cancelled_by = seller, verify current user = buyer
2. Check user hasn't already responded (one response per person)
3. Update cancellation_comments table:
   - response_by_user_id = current user
   - response_text = provided text
   - response_at = NOW()
4. Send email notification to original commenter
5. Return success

Security checks:
- 403 if user is not the other party
- 403 if user already responded
- 403 if transaction doesn't exist
- 400 if response text empty or > 500 chars

4. DISPLAY BOTH COMMENT AND RESPONSE

After response posted, display both in transaction history:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ CANCELLED BY BUYER - September 28, 2024 â”‚
â”‚                                             â”‚
â”‚ ğŸ’» MacBook Pro 16" - $2,200                â”‚
â”‚ Buyer: John Davis â­ 3.6/5.0               â”‚
â”‚ Seller: David Chen â­ 4.9/5.0              â”‚
â”‚ Role: Seller (viewing as David)             â”‚
â”‚ Status: Cancelled 2 hours before meetup     â”‚
â”‚                                             â”‚
â”‚ ğŸ’¬ John's Cancellation Comment:             â”‚
â”‚ Reason: Personal emergency                  â”‚
â”‚ "I'm really sorry for the late             â”‚
â”‚  cancellation. My wife surprised me with   â”‚
â”‚  the same laptop as an early birthday      â”‚
â”‚  gift. I tried to cancel earlier but just  â”‚
â”‚  found out an hour ago. Again, my          â”‚
â”‚  apologies for any inconvenience."          â”‚
â”‚ Posted: Sep 28, 2024 at 2:15 PM             â”‚
â”‚                                             â”‚
â”‚ ğŸ’¬ David's Response:                        â”‚
â”‚ "Thanks for explaining! Would have         â”‚
â”‚  appreciated more notice, but I            â”‚
â”‚  understand. Congratulations on the gift!" â”‚
â”‚ Posted: Sep 28, 2024 at 3:30 PM             â”‚
â”‚                                             â”‚
â”‚ ğŸ‘ Helpful (23)  ğŸ‘ (1)  [Report]           â”‚
â”‚ â†‘ Community can vote if exchange was       â”‚
â”‚   professional/reasonable                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. DISPLAY ON PUBLIC PROFILES

When viewing someone else's profile, show both sides:

On John's profile (the canceller):
Shows his comment AND the seller's response

On David's profile (the cancelled party):
Shows the buyer's comment AND his response

Both appear on both profiles for transparency.

6. EMAIL NOTIFICATION

When someone responds to your cancellation comment:

Subject: David responded to your cancellation comment

Hi John,

David Chen has responded to your cancellation comment on:
MacBook Pro 16" - $2,200

YOUR COMMENT:
"I'm really sorry for the late cancellation. My wife 
just surprised me with the same laptop as an early 
birthday gift..."

DAVID'S RESPONSE:
"Thanks for explaining! Would have appreciated more 
notice, but I understand. Congratulations on the gift!"

This response is now visible on both of your public 
profiles.

[View Full Conversation]

- SellFast.now Team

7. EDIT RESTRICTIONS

Once posted:
- Responses cannot be edited (only deleted by admin)
- Only ONE response per person per cancellation
- After 48 hours, responses are permanent

If user wants to "respond again":
- Show message: "You've already responded to this cancellation"
- Display their existing response

8. HELPFUL VOTING (Optional for this step)

Add voting to comment + response thread:
- Users can vote if the exchange was professional
- Thumbs up / Thumbs down
- Shows community sentiment
- (Can implement in later polish phase if time)

TESTING:

Test Case 1: Respond to cancellation comment
1. User A cancels with comment
2. User B (other party) sees cancellation in their history
3. User B clicks "Respond to Comment"
4. User B writes: "Thanks for explaining!"
5. Submit response
6. Verify:
   - Response saved in database
   - Response visible in transaction history
   - Email sent to User A
   - Button changes to "Edit Response" or disappears

Test Case 2: Security - wrong user tries to respond
1. User C (not involved in transaction) tries to respond
2. Should get 403 Forbidden error
3. No response saved

Test Case 3: Can't respond twice
1. User B responds to comment
2. User B tries to respond again
3. Should see message: "You already responded"
4. Can view their existing response

Test Case 4: View on public profile
1. Navigate to User A's profile (the canceller)
2. View transaction history
3. See cancellation with their comment
4. See User B's response below
5. Both are public

Test Case 5: Private comment handling
1. User A cancels with private comment
2. User B can still respond
3. Both comment and response remain private
4. Only involved parties see them

Test Case 6: Email notification
1. User B responds
2. User A receives email
3. Email contains both comment and response
4. "View Full Conversation" link works

Test Case 7: Empty response
1. Try to submit empty response
2. Should show validation error
3. "Response cannot be empty"

Test Case 8: Character limit
1. Write 501 character response
2. Should show error
3. "Response must be 500 characters or less"
4. Character counter turns red

DELIVERABLES:
1. "Respond" button on cancellation comments
2. Response modal with character counter
3. API endpoint with security checks
4. Display of comment + response together
5. Email notification system
6. One-response-per-user enforcement
7. Public/private handling
8. All test cases passing